---

### TODO功能列表

- [] 49 宁夏回族自治区公共资源交易网 图片功能未完成 - wwj

---

### TODO抓取列表

- [X] 0 全国 http://www.ggzy.gov.cn/

- [] 1 全国 http://www.cebpubservice.com/

- [X] 2 北京 http://ggzyfw.beijing.gov.cn
- [X] 3 天津 http://ggzy.zwfwb.tj.gov.cn/
- [X] 4 河北 http://ggzy.hebei.gov.cn/
- [X] 5 山西 http://prec.sxzwfw.gov.cn

- [] 6 内蒙古 http://ggzyjy.nmg.gov.cn
- [] 7 辽宁 http://www.lnggzy.gov.cn/

- [X] 8 吉林 http://www.jl.gov.cn/ggzy/

- [] 9 吉林 http://www.ggzyzx.jl.gov.cn/

- [X] 10 黑龙江 http://hljggzyjyw.gov.cn
- [X] 11 上海 http://www.shggzy.com

- [] 12 上海 http://www.shcpe.cn/jyfw/xxfw/index.html

- [X] 13 江苏 http://jsggzy.jszwfw.gov.cn/
- [X] 14 浙江 http://www.zjpubservice.com
- [X] 15 浙江 http://www.zmctc.com/zjgcjy/jyxx/

- [] 16 安徽 http://ggzy.ah.gov.cn/
- [] 17 福建 https://ggzyfw.fujian.gov.cn/

- [X] 18 福建 http://www.fjggzyjy.cn/
- [X] 19 江西 https://www.jxsggzy.cn/web/

- [] 20 江西 http://ncztb.nc.gov.cn/nczbw/
- [] 21 山东 http://ggzyjy.shandong.gov.cn/
- [] 22 山东 http://ggzyjyzx.shandong.gov.cn/
- [] 23 河南 http://hnsggzyfwpt.hndrc.gov.cn/
- [] 24 河南 http://www.hnggzy.com/hnsggzy/
- [] 25 河南 http://slt.henan.gov.cn/bmzl/jsgl/ztbxx/
- [] 26 湖北 http://jycg.hubei.gov.cn/
- [] 27 湖北 http://www.hbggzyfwpt.cn/

- [X] 28 湖南 https://ggzy.hunan.gov.cn/

- [] 29 湖南 https://www.hnsggzy.com/

- [X] 30 广东 http://bs.gdggzy.org.cn/osh-web/

- [] 31 广东 http://www.gzggzy.cn/
- [] 32 广东 http://www.zgazxxw.com/
- [] 33 广西 http://gxggzy.gxzf.gov.cn/
- [] 34 海南 http://zw.hainan.gov.cn/ggzy/
- [] 35 海南 http://www.hainan.gov.cn/hainan/ggzy/list.shtml
- [] 36 海南 https://hng.zbytb.com/
- [] 37 海南 https://www.ccgp-hainan.gov.cn/zhuzhan/
- [] 38 海南 http://www.hncq.cn/

- [X] 39 重庆 https://www.cqggzy.com/

- [] 40 四川 http://ggzyjy.sc.gov.cn/
- [] 41 贵州 http://ggzy.guizhou.gov.cn/
- [] 42 云南 http://ggzy.yn.gov.cn/
- [] 43 云南 https://www.ynggzy.com/
- [] 44 西藏 http://ggzy.xizang.gov.cn:9090/

- [X] 45 陕西 http://www.sxggzyjy.cn/

- [] 46 甘肃 https://ggzyjy.gansu.gov.cn
- [] 47 青海 https://www.qhdzzbfw.gov.cn/
- [] 48 青海 http://www.qhggzyjy.gov.cn/

- [X] 49 宁夏 http://www.nxggzyjy.org/

- [] 50 新疆 http://zwfw.xinjiang.gov.cn/xinjiangggzy/

- [X] 51 兵团 http://ggzy.xjbt.gov.cn/

- [] 52 品茗-嗨招 https://www.hibidding.com/
- [] 53 必联 https://www.ebnew.com/
- [] 54 E共享交易平台 http://ebid.okap.com/
- [] 55 天工招采平台 http://zhaobiao.tgcw.net.cn/cms/index.htm
- [] 56 建投商务网 https://www.jtsww.com/
- [] 57 精彩纵横 http://jczh.jczh100.com/
- [] 58 明信阳光 http://www.51ygcg.com/
- [] 59 鑫智链招标 http://www.njxic.cn/
- [] 60 安阳公共资源交易 http://www.ayggzy.cn/
- [] 61 优质采电子交易 https://www.youzhicai.com/MScene/Mtender
- [] 62 新点平台 https://www.etrading.cn/
- [] 63 广咨E招 https://www.gzebid.cn/
- [] 64 国信创新电子交易平台 http://www.e-bidding.org/
- [] 65 国e平台 https://www.ebidding.com/portal/html/index.html#page=main:announcement
- [] 66 阳光一路 http://www.ahggzyjt.com/
- [] 67 阳光易招 http://www.sunbidding.com/
- [] 68 齐鲁招采网 http://www.qlebid.com/
- [] 69 广东电子招标平台 https://www.bidnews.cn/gdbid/
- [] 70 易招标-招采进宝（全国） http://china.zcjb.com.cn/cms/index.htm
- [] 71 易招标-招采进宝（河北） http://hb.zcjb.com.cn/cms/index.htm
- [] 72 易招标-招采进宝（山西） http://sxty.ebidding.net.cn/cms/index.htm
- [] 73 易招标-招采进宝（山东） http://sd.zcjb.com.cn/cms/index.htm
- [] 74 易招标-招采进宝（安徽） http://ah.zcjb.com.cn/cms/index.htm
- [] 75 易招标-招采进宝（新疆） http://xj.zcjb.com.cn/cms/index.htm
- [] 76 E招冀成 http://www.hebeibidding.com/
- [] 77 招必得 https://www.zhaobide.com/
- [] 78 住宅修缮工程招投标 http://xsjypt.fgj.sh.gov.cn/
- [] 79 信e采 https://www.ahbidding.com/
- [] 80 兖矿招采平台 http://www.ykjtzb.com/
- [] 81 —联易招交易平台 http://www.ebid.sh.cn/
- [] 82 比德电子采购平台 http://www.bdebid.com/
- [] 83 旺采网 https://sx.5ibid.net/
- [] 84 中国铁路上海局集团有限公司物资采购商务平台 http://222.44.91.31/index.jsp
- [] 85 安装信息网 http://m.zgazxxw.com/
- [] 86 中国联通招标网 http://m.zgazxxw.com/da-010001l772-0.html
- [] 87 中国电子招标网 https://www.ztb365.cn/
- [] 88 中国电子招标网-铁路 https://www.ztb365.cn/tlzb/
- [] 89 铁路招标 http://www.tieluzb.com/
- [] 90 上海地铁 http://www.shmetro.com/
- [] 91 广州地铁 http://bid.gzmtr.com/
- [] 92 广州地铁招标投标网站 http://www.gzmtr.com/bid/bizzbgg/
- [] 93 杭州地铁 http://www.hzmetro.com/tender_0.aspx#midc
- [] 94 深圳地铁 https://www.szmc.net/zhaobiaozhaoshang/
- [] 95 北京地铁 http://www.bjmetro.com.cn/ecp/
- [] 96 成都地铁 https://ep.cdmetro.cn:1443/suneps/login.jsp;jsessionid=Vv7-UGSjKF18XSk5V9wUcYEjXwLwhmKYRggEM4JR2MwVh4W35wTj!2090317832
- [] 97 西安地铁 https://www.xianrail.com/#/biddingProcurement
- [] 98 武汉地铁 http://www.whrtyycg.com/#!web/homePage.jsx
- [] 99 沈阳地铁 http://www.symtc.com/contentlist.php?301
- [] 100 青岛地铁 http://www.qd-metro.com/tender/list.php?sid=49
- [] 101 济南地铁 http://www.jngdjt.cn/html/zbtb/
- [] 102 苏州轨道交通 http://www.sz-mtr.com/tender/notice/
- [] 103 合肥地铁 http://www.hfgdjt.com/category/notice/pur_notice/
- [] 104 郑州地铁 https://www.zzmetro.cn/page/id/37.html
- [] 105 石家庄轨交 http://www.sjzmetro.cn/cyportal2.3/template/site00_Tender_Notice@gdb.jsp?a1b2dd=7xaac
- [] 106 绍兴地铁 http://www.sxsmtr.cn/index.php?m=content&c=index&a=lists&catid=16
- [] 107 宁波轨交 http://www.nbmetro.com/tender_report.php
- [] 108 温州轨交 https://www.wzmtr.com/Col/Col109/Index.aspx
- [] 109 福州地铁 http://www.fzmtr.com/html/fzdt/pagenoticelist/1596446278.html
- [] 110 厦门地铁 https://www.xmgdjt.com.cn/Modules/ControlHtml/Bidding.aspx
- [] 111 长沙轨交 http://www.hncsmtr.com/zbtb/index.html
- [] 112 辽宁政府采购网 http://www.ccgp-liaoning.gov.cn
- [] 113 辽宁建设工程信息网 http://www.hncsmtr.com/zbtb/index.html
- [] 114 光咨电子招投标交易平台 https://www.gzebid.cn/
- [] 115 全国招标信息网 https://www.bidnews.cn/zjzd/

---

###地方
# 北京地区
- [] 1101 北京市海淀区人民政府  http://www.bjhd.gov.cn/
- [] 1102 北京市政府采购网  http://www.ccgp.gov.cn/

# 上海地区
- [] 3101 上海市政府采购网  http://www.ccgp-shanghai.gov.cn/

# 浙江地区
- [] 3301 杭州公共资源交易网  https://www.hzctc.cn/
- [] 3302 浙江政府采购网  https://zfcg.czt.zj.gov.cn/
- [] 3303 浙江省能源集团电子招投标平台  https://www.zeec.cn/
- [] 3304 浙江省水利厅  http://slt.zj.gov.cn/
- [] 3305 宁波公共资源交易网  http://bidding.ningbo.gov.cn/
- [] 3306 嘉兴公共资源交易网  http://jxszwsjb.jiaxing.gov.cn/
- [] 3307 湖州公共资源交易网  http://ggzy.huzhou.gov.cn/
- [] 3308 衢州公共资源交易中心  http://ggzy.qz.gov.cn/
- [] 3309 溫州公共资源交易网  https://ggzyjy.wenzhou.gov.cn/
- [] 3310 台州公共资源交易网  http://tzztb.zjtz.gov.cn/
- [] 3311 丽水公共资源交易中心  http://lssggzy.lishui.gov.cn/
- [] 3312 绍兴公共资源交易网  http://ggb.sx.gov.cn/
- [] 3313 舟山公共资源交易中心  http://zsztb.zhoushan.gov.cn/
- [] 3314 杭州余杭门户网站  http://www.yuhang.gov.cn/
- [] 3315 柯桥区公共资源交易中心  https://www.hibidding.com/
- [] 3316 诸暨公共资源交易网  http://ggb.zhuji.gov.cn/
- [] 3317 浙江招标网  https://zj.bidcenter.com.cn/
- [] 3318 金华市公共资源交易中心  http://ggzyjy.jinhua.gov.cn/cms/
- [] 3319 长兴县公共资源交易中心  http://ggzy.zjcx.goc.cn/cxweb/
- [] 3320 苍南县公共资源交易中心  http://ggzy.cncn.gov.cn/TPFrontNew/
- [] 3321 临海市公共资源交易中心  http://www.linhai.gov.cn/
- [] 3322 安吉公共资源交易中心    http://ggzy.anji.gov.cn/
- [] 3323 萧山政府门户网站  http://www.xiaoshan.gov.cn/
- [] 3324 南浔区公共资源交易中心  http://ggzy.nanxun.gov.cn/
- [] 3325 德清县公共资源交易中心  http://116.62.168.209/zbgg/index.htm
- [] 3326 龙游县公共资源交易中心  http://ztb.longyou.gov.cn/
- [] 3327 平阳县公共资源交易中心  http://www.zjpy.gov.cn/
- [] 3328 常山县公共资源交易网  http://qzcs.zjzwfw.gov.cn/
- [] 3329 拱墅区公共资源交易中心  http://www.gongshu.gov.cn/
- [] 3330 江干区公共资源交易中心  http://www.jianggan.gov.cn/
- [x] 3331 富阳区公共资源交易中心  http://www.fuyang.gov.cn/
- [x] 3332 淳安县公共资源交易中心  http://www.qdh.gov.cn/
- [] 3333 浙江交通运输厅  http://jtyst.zj.gov.cn/

- [] 3334 建德市公共资源交易中心  http://www.jiande.gov.cn/
- [] 3335 温州市鹿城区公共资源交易中心 http://spgg.lucheng.gov.cn/
- [] 3336 温州市乐清市公共资源交易中心 http://ggzy.yueqing.gov.cn/
- [] 3337 温州市瑞安市公共资源交易中心 http://ggzy.ruian.gov.cn/
- [] 3338 温州市永嘉县公共资源交易中心 http://ggzy.yj.gov.cn/
- [] 3339 温州市洞头区公共资源交易中心 http://www.dongtou.gov.cn/
- [] 3340 温州市文成县公共资源交易中心 http://ggjy.wencheng.gov.cn/
- [] 3341 温州市泰顺县公共资源交易中心 http://www.ts.gov.cn/
- [] 3342 绍兴市上虞区公共资源交易中心 http://xxgk.shangyu.gov.cn/
- [] 3343 绍兴市新昌县公共资源交易中心 http://www.zjxc.gov.cn/
- [] 3344 绍兴市越城区公共资源交易中心 http://www.sxyc.gov.cn/
- [] 3345 绍兴市嵊州市公共资源交易中心 http://www.szzj.gov.cn/
- [] 3346 湖州市吴兴区公共资源交易中心 http://www.wl.gov.cn/

- [] 3347 台州市温岭市公共资源交易中心 http://www.wl.gov.cn/
- [] 3348 台州市三门县公共资源交易中心 http://jyzx.sanmen.gov.cn/
- [] 3349 台州市天台县公共资源交易中心 http://www.zjtt.gov.cn/ 
- [] 3350 台州市仙居县公共资源交易中心 http://www.zjxj.gov.cn/
- [] 3351 金华市婺城区公共资源交易中心 http://www.wuch.gov.cn/
- [] 3352 金华市金东区公共资源交易中心 http://www.jindong.gov.cn/
- [] 3353 金华市兰溪市公共资源交易中心 http://www.lanxi.gov.cn/
- [] 3354 金华市东阳市公共资源交易中心 http://www.dongyang.gov.cn/
- [] 3355 金华市永康市公共资源交易中心 http://www.yk.gov.cn/
- [] 3356 金华市义乌市公共资源交易中心 http://ggfw.ywjypt.yw.gov.cn/
- [] 3357 衢州市衢江区公共资源交易中心 http://www.qjq.gov.cn/
- [] 3358 衢州市开化县公共资源交易中心 http://www.kaihua.gov.cn/
- [] 3359 衢州市柯城区公共资源交易中心 http://www.qjq.gov.cn/

### 反爬策略汇总

> 49 宁夏回族自治区公共资源交易网
>
>> 问题：提取页面数据时，id是页面加载完之后再添加的`<br>`
>> 解决：提取原始界面分析xpath再提取`<br>`
>>

> 08 山西省公共资源交易平台
>
>> 问题：信息类型分类时需要POST http://prec.sxzwfw.gov.cn/queryContent-jyxx.jspx
>>

---

### 各站点异常统计

> 53 必联网
>
>> https://www.ebnew.com/businessShow/664346381.html，附件是一个展示链接
>> 不是一个下载链接，当前无解决方案                          ——2021-4-22
>>

> 57 精彩纵横
>
> # 代理机构已解析   后期可以不用清洗
>
> 该网站有两种分类 需要分别使用两种url请求 参数不一样          --2021-5-07

> 3318  浙江金华公共资源交易中心  附件是需要先请求的get_url()方法  获取相应的uid 进行拼接
> --2021-04-28

### install 命令

> C:\Users\PC\AppData\Local\Programs\Python\Python39\python.exe
> C:\Users\PC\AppData\Local\Programs\Python\Python39\Scripts\pip3.9.exe

> pip install --index-url https://pypi.douban.com/simple `<br>`
> pip --default-timeout=1000 install PyQt5==5.10.1`<br>`
> pip --default-timeout=1000 install -i https://pypi.tuna.tsinghua.edu.cn/simple scrapy `<br>`
> pip --default-timeout=1000 install -i https://pypi.tuna.tsinghua.edu.cn/simple -r requirements.txt `<br>`

> C:\Users\PC\AppData\Local\Programs\Python\Python39\Scripts\pip3.9.exe --default-timeout=1000 install -i https://pypi.tuna.tsinghua.edu.cn/simple

> C:\Users\PC\AppData\Local\Programs\Python\Python39\Scripts\pip3.9.exe freeze > requirements.txt

### 源码修改

文件：
C:\Users\PC\AppData\Local\Programs\Python\Python39\Lib\site-packages\scrapy\spiders\crawl.py
修改：
第101行（request = self._build_request(rule_index, link)）下面增加一行
request.meta["cb_kwargs"] = rule.cb_kwargs

### 打包上传脚本命令(非虚拟环境，虚拟环境自行修改路径)

前置

> 先安装scrapyd-client`<br>`
> 在该目录下新建scrapyd-deploy.bat 路径如下`<br>`
> C:\Users\PC\AppData\Local\Programs\Python\Python39\Scripts
> 开始写入`<br>`
> @echo off`<br>`
> "C:\Users\PC\AppData\Local\Programs\Python\Python39\python.exe" "C:\Users\PC\AppData\Local\Programs\Python\Python39\Scripts\scrapyd-deploy" %*`<br>`
> 写入结束`<br>`

命令(暂行，后面改成可视化操作)

> 打包上传spiders`<br>`
> scrapyd-deploy data-server -p spider_pro`<br>`

=======

### 代码上传至服务器

# scrapyd_timing

scp  D:\ztx_clone\ztx_spider\scrapyd_timing.py root@192.168.1.248:/home/python/scripts/scrapyd_timing.py

# scrapyd_timing_post

scp  D:\ztx_clone\ztx_spider\scrapyd_timing_post.py root@192.168.1.248:/home/python/scripts/scrapyd_timing_post.py

# scrapyd_clean_data

scp  D:\ztx_clone\ztx_spider\scrapyd_clean_data.py root@192.168.1.248:/home/python/scripts/scrapyd_clean_data.py

### 容器部署

* MySQL
  版本：5.7
  配置文件：

  ```
  [mysql]
  default-character-set=utf8
  [mysqld]
  skip-grant-tables 
  datadir=/var/lib/mysql
  socket=/var/lib/mysql/mysql.sock
  user=mysql
  # Disabling symbolic-links is recommended to prevent assorted security risks
  symbolic-links=0
  character-set-server=utf8
  default-storage-engine=INNODB
  [mysqld_safe]
  log-error=/var/log/mysqld.log
  pid-file=/var/run/mysqld/mysqld.pid
  ```
* redislabs
* scrapyd

  - requirements.txt
    ```
    DBUtils==2.0.1
    gevent==21.1.2
    lxml==4.6.3
    numpy==1.20.2
    openpyxl==3.0.7
    pandas==1.2.3
    PyMySQL==1.0.2
    python-dateutil
    pytz==2021.1
    redis==3.5.3
    requests==2.5.0
    Scrapy==2.4.1
    SQLAlchemy==1.4.0
    Twisted==21.2.0
    urllib3==1.26.4
    xlwt==1.3.0
    xmltodict==0.12.0
    scrapyd
    scrapyd-client
    scrapy-redis
    redisbloom
    pycryptodome
    ```
  - Dockerfile
    ```
    FROM python:3.9
    #add the scrapyd configure file

    # set timezone
    RUN ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
    RUN echo 'Asia/Shanghai' >/etc/timezone

    ADD ./conf/scrapyd.conf /etc/scrapyd/scrapyd.conf
    #add requirements.txt
    ADD requirements.txt /opt/requirements.txt
    WORKDIR /opt
    #use other fast image
    RUN pip3 install  -i https://pypi.tuna.tsinghua.edu.cn/simple -r requirements.txt

    CMD ["scrapyd"]

    EXPOSE 6800
    ```
* 创建容器

  ```
  docker run -p 8050:3306 --name ztx_mysql \
  -v $PWD/MYSQL/conf.d:/etc/mysql/conf.d \
  -v $PWD/MYSQL/logs:/logs \
  -v $PWD/MYSQL/data:/var/lib/mysql \
  -e MYSQL_ROOT_PASSWORD=Ly3sa%@D0$pJt0y6 \
  -d mysql:5.7


  docker run -p 8090:6379 --restart=always --name ztx_redis \
  -d redislabs/rebloom:latest

  docker run -d -p 8060:6801 scrapyd
  ```

>>>>>>> Stashed changes
>>>>>>>
>>>>>>
>>>>>
>>>>
>>>
>>
